name: Ultimate Dev Environment - Ubuntu 24.04 Lite

on:
  workflow_dispatch:
  push:
    tags:
      - 'v24.04-arm64'

permissions:
  contents: write  # â† WAJIB agar bisa upload ke GitHub Release

jobs:
  ultimate-dev-setup:
    runs-on: ubuntu-24.04
    timeout-minutes: 30  # â±ï¸ Batasi runtime agar tidak hang selamanya

    steps:
      - name: âœ… Checkout Repo
        uses: actions/checkout@v4

      - name: ğŸ”„ Update & Upgrade
        run: |
          sudo apt update && sudo apt upgrade -y

      - name: ğŸ› ï¸ Install CLI + Build Tools
        run: |
          sudo apt install -y \
            git curl wget unzip zip neovim tmux build-essential \
            make gcc g++ zsh jq htop tree net-tools

      - name: ğŸ”£ Install Language Runtimes
        run: |
          sudo apt install -y \
            python3 python3-pip nodejs npm golang-go openjdk-21-jdk

      - name: ğŸŒ Install Web Stack
        run: |
          sudo apt install -y \
            nginx mariadb-server redis-server

      - name: ğŸ³ Install Docker & Compose
        run: |
          sudo apt install -y docker.io docker-compose
          sudo systemctl enable docker
          sudo systemctl start docker

      - name: ğŸ“¦ Install Python Dev Libraries (non-AI)
        run: |
          pip install --upgrade pip
          pip install numpy pandas matplotlib flask jupyter requests

      - name: ğŸ›¡ï¸ Install Security Tools
        run: |
          sudo apt install -y \
            ufw nmap netcat openssh-client fail2ban

      - name: ğŸ” Enable UFW Firewall
        run: |
          sudo ufw allow OpenSSH
          sudo ufw allow 80
          sudo ufw allow 443
          sudo ufw --force enable

      - name: ğŸ“‹ Show Installed Versions
        run: |
          echo "--- VERSIONS ---"
          git --version
          node -v
          npm -v
          python3 --version
          go version
          java -version
          docker --version
          docker-compose --version
          nginx -v
          mariadb --version
          redis-server --version

      - name: ğŸ—œï¸ Compress Dev Configs Snapshot
        run: |
          mkdir -p dev-env-snapshot
          cp -r ~/.config dev-env-snapshot/config || true
          cp -r ~/.local dev-env-snapshot/local || true
          tar -czf ubuntu24-lite-env-v24.04.tar.gz dev-env-snapshot

      - name: â˜ï¸ Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ubuntu24-lite-env-v24.04
          path: ubuntu24-lite-env-v24.04.tar.gz

      - name: ğŸš€ Upload to GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v24.04-arm64
          files: ubuntu24-lite-env-v24.04.tar.gz
          generate_release_notes: true
          draft: false
          prerelease: false
          name: Ubuntu 24.04 Dev Env Snapshot
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
